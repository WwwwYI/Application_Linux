## 网络相关知识简介

- 物理层：传输信号所需要的物理电平、介质特性
- 链路层：==MAC== 规定了数据帧能被网卡接受的条件，最常见的方式就是利用网卡的MAC地址，发送方再欲发送的数据帧的首部加上接受方网卡的MAC地址信息，接收方只能监听到主语自己的MAC地址信息后，才会去接受并处理数据
- 网络层：每台网络设备都有自己的网络地址，网络层规定了主机的网络地址该如何定义，以及如何在网络地址和MAC地址之间进行映射——即***ARP协议***，网络层实现了数据包在主机之间的传递
- 传输层：区分数据包是属于哪一个应用程序的，可以说传输层实现了数据包端到端的传递，另外，数据包在传输过程中可能会丢包、乱序和重复的现象，网络层并没有提供应对这些错误的机制，传输层可以解决这些问题，如TCP协议
- 应用层：决定你如何应用和处理这些数据；

<img src="F:\A_Sources\A笔记整理\图片\网络分层.png" style="zoom:60%;" />

### 报文间的封装与拆封

1. 用户产生数据，向下交给传输层，这是应用层的操作，应用层也有相关协议，对用户的数据进行封装，如MQTT、HTTP等，最后应用层通过调用传输层的接口来降数据传递给传输层
2. 传输层会在数据前面加上传输层头部，如TCP/UDP首部，然后下交给网络层
3. 网络层会在数据前面加上网络层首部（IP首部），然后将数据交给链路层
4. 链路层对数据进行最后一次封装，在数据前面加上链路层首部，然后将数据交给网卡
5. 网卡将数据转换成物理链路上的电平信号，数据就被发送到了网络中

<img src="F:\A_Sources\A笔记整理\图片\封包.png" style="zoom:60%;" />

### IP协议

Internet Protocol ，工作于IP层工作，是整个TCP/IP协议栈的核心协议，上层协议都要依赖IP协议提供的服务

IP协议负责将数据报从源主机发送到目标主机，通过IP地址作为唯一识别码。不同主机的IP地址是不一样的，在发送数据包的过程中，IP协议可能对数据报进行分片处理，同时在接受数据报的时候还可能需要对分片的数据包进行重装。

设计人员为每个接入网络中的主机都分配一个IP地址（Internet  Protocol  Address），是一个32位的整数地址

- IP地址是软件地址，不是硬件地址。硬件MAC地址是存储在网卡中的，应用于本地网络中寻找目标主机。
- IP地址能让一个网络中的二主机能够与另一个网络中的主机进行通信，无需理会这些主机之间的MAC地址

### IP地址编址

每个IP地址的一部分都由其所在的子网决定的，IP的类型决定了IP地址将如何划分成网络部分和节点部分，在分类编址中，设计者把所有IP地址划分位5大类，分别为 A、B、C、D、E五类，每一类地址都决定了其中IP地址的一部分组成。

<img src="F:\A_Sources\A笔记整理\图片\IP地址编址.png" style="zoom:80%;" />

### UDP协议

User Datagram protocol——用户数据报协议，是一种无连接、不可靠的协议，他只是简单地实现从一端主机到另一端主机的数据传输功能，这些数据通过IP层发送。

UDP只是把上层应用的数据封装到UDP报文中没在差错检查方面，仅仅是对数据进行了简单的校验，然后将其封装到IP数据报中发送出去，在接收端，无论是否收到数据，都不会产生一个应答发送给源主机。并且如果接收到数据发送校验错误，那么接收端就会丢弃该UDP报文，也不会告诉源主机

***UDP协议的特点***

1. 无连接、不可靠
2. 尽可能提供交付数据服务，出现差错直接丢弃，无反馈。
3. 面向报文，发送方的UDP拿到上层数据后直接添加个UDP首部，然后进行校验后就递交给了IP层，而接收的乙方在接收到UDP报文后简单进行校验，然后直接取出数据递交给上层应用。
4. 支持一对一，一对多，多对一，多对多的交互通信
5. 速度快，UDP没有TCP的握手、确认、窗口、重传、拥塞控制等机制。UDP是一个无状态的传输协议，所以它在传递数据时非常快，即使在网络拥塞的时候UDP也不会降低发送的数据

### TCP协议

TCP提供一种面向连接、可靠的字节流传输服务，TCP让两个主机建立连接的关系，应用数据以数据流的形式进行传输，这与UDP协议是不一样的

==TCP、UDP区别==

- UDP运载的数据是以报文的形式，各个报文在网络中互不相干传输，UDP每收到一个报文就递交给上层应用，因此如果对于大量数据来说，应用层的重装是非常麻烦的，因为UDP报文在网络中到达目标主机的顺序是不一样的；
- 而TCP采用数据流的形式传输，先后发出的数据在网络中虽然也是互不相干的传输，但是这些数据本身携带的信息却是紧密联系的，TCP协议会给每个传输的字节进行编号，当然啦，两个主机方向上的数据编号是彼此独立的，在传输的过程中，发送方把数据的起始编号与长度放在TCP报文中，在接收方将所有数据按照编号组装起来，然后返回一

***TCP的特性***

1.连接机制

TCP是一个面向连接的协议，无论哪一方向另一方发送数据之前，都必须现在双方之间建立一个连接，否则无法发送数据，一个TCP连接必须有双方的IP号与端口号。

2.确认与重传

一个完整的TCP传输必须有数据的交互，接受放在接收到数据之后必须正面进行确认，向发送方报告接受的结果，而发送方在发送数据之后必须等待接收方的确认，同时发送的时候会启动一个定时器，在指定超时时间内没收到确认，发送方就会认为发送失败，然后进行重发操作——**重传报文**

3.缓冲机制

数据量很小的时候，TCP会将数据存储在一个缓冲空间中，等到数据量足够大的时候在进行发送数据。

而且在数据发送出去的时候并不会立即删除数据，还是让数据保存在缓冲区中，因为发送出去的数据不一定能被接收方正确接收，它需要等待到接收方的确认再将数据删除。

接受方也需要有同样的缓冲机制，在网络中传输的数据报到达时间是不一样的，而且TCP协议还需要把这些数据包组装成完整的数据，然后再递交给应用层

4.全双工通信

在TCP连接建立后，那么两个主机就是对等的，任何一个主机都可以向另一个主机发送数据，数据是双向流通的，所以TCP协议是一个全双工的协议。

TCP协议的确认是通过捎带的方式来实现，即接收方把确认信息放到反向传来的是数据报文中，不必单独为确认信息申请一个报文，捎带机制减少了网络中的通信流量。任意一方断开连接，此时这个方向上的数据流就断开了，单另一个方向上的数据仍然是连通的状态

5.流量控制

流量控制是一个速度匹配服务，即发送方的发送速率与接收方应用程序的读取速率相匹配，TCP通过让发送方维护一个称为接收窗口（receive window）的变量来提供流量控制，它用于给发送方一个指示：接收方还能接收多少数据，接收方会将此窗口值放在 TCP 报文的首部中的窗口字段，然后传递给发送方，这个窗口的大小是在发送数据的时候动态调整的。

6.差错控制

主机在接收数据的时候，会将重复的报文丢弃，将乱序的报文重组，发现某段报文丢失了会请求发送方进行重发，因此在TCP往上层协议递交的数据是顺序的、无差错的完整数据

7.拥塞控制

**拥塞:**当数据从一个大的管道（如一个快速局域网）向一个较小的管道（如一个较慢的广域网）发送时便会发生拥塞；

​		当多个输入流到达一个路由器，而路由器的输出流小于这些输入流的总和时也会发生拥塞；

发送方必须实现一直自适应的机制，在网络中拥塞的情况下调整自身的发送速度，这种形式对发送方的控制被称为拥塞控制

#### 端口号的概念

TCP来连接时两个不同主机的应用连接，而传输层与上层协议是通过端口号进行识别的。端口号的取值范围0~65535，端口标识着上层应用的不同线程，一个主机内可能只有一个IP地址，但是可能有多个端口号，每个端口号对应不同的线程。

一台拥有IP地址的主机可以提供许多服务，比如Web服务、FTP服务、SMTP服务等，这些服务完全可以通过1个IP地址来实现，主机是怎样区分不同的网络服务呢？显然不能只靠IP地址，因为IP 地址只能识别一台主机而非主机提供的服务，这些服务就是主机上的应用线程，因此是通过**“IP地址+端口号”**来区分主机不同的线程

### TCP报文段

TCP报文段由首部+数据区域组成

如果不计算选项字段，一般来说TCP首部有20个字节

<img src="F:\A_Sources\A笔记整理\图片\TCP报文.png" style="zoom:80%;" />

每个TCP报文段都包含源主机和目标主机的端口号，用于寻找发送端和接收端应用线程，这两个值加上IP首部中的源IP地址和目标IP地址就能确定唯一一个TCP连接。







​			

